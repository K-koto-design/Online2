<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö-–û–Ω–ª–∞–π–Ω</title>
    <meta name="apple-mobile-web-app-title" content="–ö-–û–Ω–ª–∞–π–Ω">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/QtVHC5G0/IMG-3035.jpg">
    <link rel="icon" type="image/png" href="https://i.postimg.cc/QtVHC5G0/IMG-3035.jpg">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>

    <style>
        :root {
            --bg-body: #0a0e14;
            --card-dark: #1c1f26;
            --grad-red: linear-gradient(135deg, #ff1f1f 0%, #b30000 100%);
            --grad-black: linear-gradient(135deg, #2d3436 0%, #000000 100%);
            --grad-blue: linear-gradient(135deg, #0984e3 0%, #2980b9 100%);
            --grad-gold: linear-gradient(135deg, #f1c40f 0%, #e67e22 100%);
            --accent: #00f2fe;
            --text-main: #ffffff;
            --text-dim: #a0a0a0;
            --radius-card: 24px;
            --radius-btn: 18px;
            --anim-screen: 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: var(--bg-body); 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif; 
            -webkit-font-smoothing: antialiased; color: var(--text-main);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        #snow-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        
        .screen { 
            display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            width: 100%; height: 100%; overflow-y: auto; 
            background: var(--bg-body); z-index: 10; opacity: 0; 
            transform: translateY(20px) scale(0.98); 
            transition: opacity var(--anim-screen), transform var(--anim-screen); 
        }
        .screen.active { display: block !important; opacity: 1; transform: translateY(0) scale(1); }

        /* Auth/PIN Screens */
        #screen-pin-entry, #screen-otp-entry { 
            background: radial-gradient(circle at top, #2c0000 0%, #0a0e14 100%); 
            display:none; flex-direction: column; justify-content: space-between; 
            align-items: center; padding: 100px 30px 60px; 
        }

        .auth-wrap { 
            padding: 100px 30px; text-align: center; min-height: 100vh; 
            background: radial-gradient(circle at bottom, #1a1a2e 0%, #0a0e14 100%); 
        }

        .logo-text { 
            font-size: 48px; font-weight: 900; 
            background: linear-gradient(to right, #fff, #ff3b30); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            margin: 0; letter-spacing: -1.5px; 
        }

        .pin-dots { display: flex; gap: 20px; margin: 40px 0; }
        .p-dot { 
            width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.2); 
            border-radius: 50%; transition: 0.3s;
        }
        .p-dot.active { 
            background: #fff; border-color: #fff; 
            box-shadow: 0 0 20px rgba(255,255,255,0.8); transform: scale(1.2);
        }

        .otp-input-group { display: flex; gap: 10px; justify-content: center; margin-top: 30px; }
        .otp-box { 
            width: 48px; height: 60px; background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 24px; font-weight: 700; color: #fff;
        }
        .otp-box.active { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 242, 254, 0.3); }

        .keypad { 
            display: grid; grid-template-columns: repeat(3, 1fr); 
            gap: 20px; width: 100%; max-width: 320px; margin-top: 20px; 
        }
        .k-btn { 
            height: 75px; width: 75px; border-radius: 50%; 
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: center; 
            font-size: 28px; backdrop-filter: blur(10px); cursor: pointer; margin: auto;
        }
        .k-btn:active { background: rgba(255,255,255,0.1); transform: scale(0.92); }

        /* Header & Dashboard */
        .header-top { 
            background: linear-gradient(180deg, #1a0000 0%, #0a0e14 100%); 
            padding: 70px 0 30px; border-radius: 0 0 40px 40px; 
            position: relative; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .user-meta { display: flex; justify-content: space-between; padding: 0 25px; align-items: center; margin-bottom: 30px; }
        
        .ava-box { 
            width: 55px; height: 55px; background: var(--grad-red); 
            border-radius: 18px; display: flex; align-items: center; justify-content: center; 
            font-weight: 800; font-size: 22px; position: relative;
            box-shadow: 0 10px 20px rgba(255, 31, 31, 0.3);
        }
        .santa-hat { position: absolute; top: -18px; left: -12px; font-size: 28px; transform: rotate(-15deg); }
        
        .scan-trigger { 
            width: 48px; height: 48px; background: rgba(255,255,255,0.05); 
            border-radius: 16px; display: flex; align-items: center; justify-content: center; 
            font-size: 20px; border: 1px solid rgba(255,255,255,0.1);
        }

        .cards-row { 
            display: flex; overflow-x: auto; padding: 10px 25px 30px; 
            gap: 20px; scrollbar-width: none; -ms-overflow-style: none;
        }
        .cards-row::-webkit-scrollbar { display: none; }

        .v-card { 
            min-width: 280px; height: 170px; border-radius: var(--radius-card); 
            padding: 25px; display: flex; flex-direction: column; 
            justify-content: space-between; position: relative; overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4); flex-shrink: 0;
        }
        .v-card::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }
        .c-black { background: var(--grad-black); color: white; }
        .c-blue { background: var(--grad-blue); color: white; }
        .c-gold { background: var(--grad-gold); color: #4a3b00; }

        /* Widgets */
        .widget { 
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 24px; padding: 20px; margin: 12px 20px; 
            display: flex; align-items: center; gap: 18px; cursor: pointer;
            transition: 0.2s;
        }
        .widget:active { transform: scale(0.97); background: rgba(255,255,255,0.06); }
        .w-ico { 
            width: 52px; height: 52px; border-radius: 16px; 
            display: flex; align-items: center; justify-content: center; font-size: 24px; 
        }

        /* History */
        .h-item { 
            background: rgba(255,255,255,0.02); border-radius: 20px; 
            padding: 16px; display: flex; align-items: center; gap: 15px; 
            margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.03);
        }
        .h-ico { 
            font-size: 20px; width: 48px; height: 48px; 
            background: rgba(255,255,255,0.05); border-radius: 14px; 
            display: flex; align-items: center; justify-content: center; 
        }
        .h-info { flex: 1; }
        .h-name { font-size: 15px; font-weight: 600; color: #fff; }
        .h-status { font-size: 12px; color: var(--text-dim); margin-top: 2px; }
        .h-sum { font-weight: 700; font-size: 17px; }
        .sum-neg { color: #fff; }
        .sum-pos { color: #2ecc71; }
        .sum-wait { color: #f1c40f; }

        /* Form Elements */
        input, textarea { 
            width: 100%; height: 64px; border-radius: var(--radius-btn); 
            border: 1px solid rgba(255,255,255,0.1); padding: 0 20px; 
            font-size: 17px; margin-bottom: 15px; background: rgba(255,255,255,0.05); 
            font-family: inherit; outline: none; color: #fff; transition: 0.3s;
        }
        input:focus { border-color: var(--grad-red); background: rgba(255,255,255,0.08); }
        
        .btn-main { 
            width: 100%; height: 64px; border: none; border-radius: var(--radius-btn); 
            font-size: 17px; font-weight: 700; cursor: pointer; transition: 0.3s; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-black { background: #fff; color: #000; }
        .btn-black:active { transform: scale(0.96); opacity: 0.9; }
        .btn-red { background: var(--grad-red); color: #fff; }
        .btn-pay { background: var(--accent); color: #000; box-shadow: 0 10px 20px rgba(0, 242, 254, 0.3); }

        /* Modals */
        .modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 9999; align-items: center; 
            justify-content: center; backdrop-filter: blur(15px); padding: 20px;
        }
        .modal-in { 
            background: #1c1f26; width: 100%; max-width: 340px; 
            border-radius: 35px; padding: 40px 30px; text-align: center; 
            border: 1px solid rgba(255,255,255,0.1);
        }

        .history-trigger { position: absolute; top: 65px; right: 85px; font-size: 24px; cursor: pointer; z-index: 100; opacity: 0.8; }
        
        /* Scanner UI */
        #qr-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: none; }
        .qr-overlay { position: absolute; inset: 0; border: 60px solid rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; }
        .qr-cutout { 
            width: 260px; height: 260px; border: 2px solid var(--accent); 
            border-radius: 30px; box-shadow: 0 0 0 2000px rgba(0,0,0,0.3);
            position: relative;
        }
        .qr-cutout::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--accent); animation: scan 2s linear infinite;
        }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
    </style>
</head>
<body>
    <canvas id="snow-canvas"></canvas>

    <div id="qr-screen">
        <div id="reader"></div>
        <div class="qr-overlay"><div class="qr-cutout"></div></div>
        <button onclick="bank.closeScanner()" style="position:fixed; bottom:60px; left:50%; transform:translateX(-50%); padding:18px 45px; border-radius:20px; background:white; border:none; font-weight:800; z-index:10001; font-size:16px;">–û–¢–ú–ï–ù–ê</button>
    </div>

    <div id="modal-qr-pay" class="modal">
        <div class="modal-in" style="background: var(--grad-black); color: white;">
            <div style="font-size:50px; margin-bottom:10px;">üí≥</div>
            <h2 style="margin:0">–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h2>
            <div id="qr-pay-sum" style="font-size:48px; font-weight:900; margin:15px 0;">0 ‚ÇΩ</div>
            <button class="btn-main btn-pay" id="confirm-qr-btn">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
            <div onclick="document.getElementById('modal-qr-pay').style.display='none'" style="margin-top:20px; opacity:0.5; font-size:14px;">–û—Ç–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</div>
        </div>
    </div>

    <div id="modal-success" class="modal">
        <div class="modal-in">
            <div style="font-size:60px; margin-bottom:15px;">üéÑ</div>
            <h2 id="suc-h" style="margin-bottom:5px;">–ì–æ—Ç–æ–≤–æ!</h2>
            <div id="suc-val" style="font-size:36px; font-weight:900; margin:10px 0; color: var(--accent);">0 ‚ÇΩ</div>
            <p id="suc-p" style="color:var(--text-dim); margin-bottom:30px; font-size:15px;"></p>
            <button class="btn-main btn-red" onclick="view.hideSuccess()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="screen-auth" class="screen active">
        <div class="auth-wrap">
            <h1 class="logo-text">–ö-–û–Ω–ª–∞–π–Ω</h1>
            <p style="color:var(--text-dim); font-weight:500; margin: 15px 0 50px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∑–∏–º–Ω—é—é —Å–∫–∞–∑–∫—É ‚ùÑÔ∏è</p>
            <input type="number" id="auth-tg-id" placeholder="–í–∞—à Telegram ID">
            <button class="btn-main btn-black" onclick="logic.requestOTP()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <p style="margin-top:35px; color:var(--text-dim); font-size: 15px;">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <span style="color:var(--accent); cursor:pointer; font-weight:600;" onclick="view.nav('screen-register')">–°–æ–∑–¥–∞—Ç—å</span></p>
        </div>
    </div>

    <div id="screen-register" class="screen">
        <div style="padding:70px 25px;">
            <div style="font-size:32px; margin-bottom:30px; cursor:pointer;" onclick="view.nav('screen-auth')">‚Üê</div>
            <h2 style="font-size:36px; font-weight:900; margin-bottom:10px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <p style="color:var(--text-dim); margin-bottom:30px;">–°—Ç–∞–Ω—å—Ç–µ —á–∞—Å—Ç—å—é –Ω–∞—à–µ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã</p>
            <input type="number" id="reg-tg-id" placeholder="Telegram ID">
            <input type="text" id="reg-name" placeholder="–í–∞—à–µ –ò–º—è">
            <input type="password" id="reg-pin" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ü–ò–ù (4 —Ü–∏—Ñ—Ä—ã)" maxlength="4">
            <button class="btn-main btn-red" onclick="logic.registerRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </div>
    </div>

    <div id="screen-otp-entry" class="screen">
        <div style="text-align:center;">
            <h2 style="font-size:28px;">–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
            <p style="opacity:0.6; font-size:15px;">–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ 6 —Ü–∏—Ñ—Ä –≤ Telegram</p>
            <div class="otp-input-group">
                <div class="otp-box" id="otp-0"></div><div class="otp-box" id="otp-1"></div><div class="otp-box" id="otp-2"></div>
                <div class="otp-box" id="otp-3"></div><div class="otp-box" id="otp-4"></div><div class="otp-box" id="otp-5"></div>
            </div>
        </div>
        <div class="keypad">
            <div class="k-btn" onclick="logic.tapOtp('1')">1</div><div class="k-btn" onclick="logic.tapOtp('2')">2</div><div class="k-btn" onclick="logic.tapOtp('3')">3</div>
            <div class="k-btn" onclick="logic.tapOtp('4')">4</div><div class="k-btn" onclick="logic.tapOtp('5')">5</div><div class="k-btn" onclick="logic.tapOtp('6')">6</div>
            <div class="k-btn" onclick="logic.tapOtp('7')">7</div><div class="k-btn" onclick="logic.tapOtp('8')">8</div><div class="k-btn" onclick="logic.tapOtp('9')">9</div>
            <div class="k-btn" style="opacity:0;"></div><div class="k-btn" onclick="logic.tapOtp('0')">0</div><div class="k-btn" onclick="logic.tapOtp('DEL')">‚å´</div>
        </div>
    </div>

    <div id="screen-pin-entry" class="screen">
        <div style="text-align:center;">
            <h2 id="pin-user-name" style="font-size:28px;">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
            <p style="opacity:0.6;">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ü–ò–ù-–∫–æ–¥</p>
            <div class="pin-dots">
                <div class="p-dot"></div><div class="p-dot"></div><div class="p-dot"></div><div class="p-dot"></div>
            </div>
        </div>
        <div class="keypad">
            <div class="k-btn" onclick="logic.tapPin('1')">1</div><div class="k-btn" onclick="logic.tapPin('2')">2</div><div class="k-btn" onclick="logic.tapPin('3')">3</div>
            <div class="k-btn" onclick="logic.tapPin('4')">4</div><div class="k-btn" onclick="logic.tapPin('5')">5</div><div class="k-btn" onclick="logic.tapPin('6')">6</div>
            <div class="k-btn" onclick="logic.tapPin('7')">7</div><div class="k-btn" onclick="logic.tapPin('8')">8</div><div class="k-btn" onclick="logic.tapPin('9')">9</div>
            <div class="k-btn" style="opacity:0;"></div><div class="k-btn" onclick="logic.tapPin('0')">0</div><div class="k-btn" onclick="logic.tapPin('DEL')">‚å´</div>
        </div>
    </div>

    <div id="screen-home" class="screen">
        <div class="history-trigger" onclick="view.nav('screen-history')">üïí</div>
        <div class="header-top">
            <div class="user-meta">
                <div>
                    <div id="h-name" style="font-size:24px; font-weight:900; letter-spacing:-0.5px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div id="h-tg" style="font-size:13px; color:var(--text-dim); margin-top:4px;">ID: ---</div>
                </div>
                <div style="display:flex; align-items:center; gap:12px;">
                    <div class="scan-trigger" onclick="bank.openScanner()">üì∑</div>
                    <div class="ava-box"><span class="santa-hat">üéÖ</span><span id="h-ava">?</span></div>
                </div>
            </div>
            <div class="cards-row" id="h-cards"></div>
        </div>

        <div style="padding:10px 0;">
            <div class="widget" onclick="view.nav('screen-transfer')">
                <div class="w-ico" style="background:rgba(255, 31, 31, 0.1); color:#ff3b30;">üéÅ</div>
                <div style="flex:1;">
                    <div style="font-weight:700; font-size:16px;">–ü–µ—Ä–µ–≤–æ–¥</div>
                    <div style="font-size:12px; color:var(--text-dim);">–ü–æ ID –∏–ª–∏ –∏–º–µ–Ω–∏</div>
                </div>
                <div style="font-size:20px; opacity:0.3;">‚Üí</div>
            </div>
            
            <div class="widget" onclick="view.nav('screen-exchange')">
                <div class="w-ico" style="background:rgba(0, 242, 254, 0.1); color:var(--accent);">üíµ</div>
                <div style="flex:1;">
                    <div style="font-weight:700; font-size:16px;">–û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã</div>
                    <div id="w-usd" style="font-size:12px; color:var(--text-dim);">–ö—É—Ä—Å: 91.20 ‚ÇΩ</div>
                </div>
                <div style="font-size:20px; opacity:0.3;">‚Üí</div>
            </div>
            
            <div class="widget" onclick="view.nav('screen-loan')">
                <div class="w-ico" style="background:rgba(241, 196, 15, 0.1); color:#f1c40f;">üåü</div>
                <div style="flex:1;">
                    <div style="font-weight:700; font-size:16px;">–ö–∞—Ä—Ç–∞ Gold</div>
                    <div style="font-size:12px; color:var(--text-dim);">–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</div>
                </div>
                <div style="font-size:20px; opacity:0.3;">‚Üí</div>
            </div>
        </div>
    </div>

    <div id="screen-history" class="screen">
        <div style="padding:70px 25px;">
            <div style="font-size:32px; margin-bottom:20px; cursor:pointer;" onclick="view.nav('screen-home')">‚Üê</div>
            <h2 style="font-size:32px; font-weight:900; margin-bottom:25px;">–ò—Å—Ç–æ—Ä–∏—è</h2>
            <div class="history-box" id="full-history-list"></div>
        </div>
    </div>

    <div id="screen-transfer" class="screen">
        <div style="padding:70px 25px;">
            <div style="font-size:32px; margin-bottom:25px; cursor:pointer;" onclick="view.nav('screen-home')">‚Üê</div>
            <h2 style="margin-bottom:30px;">–ü–µ—Ä–µ–≤–æ–¥ üéÑ</h2>
            <input type="text" id="tr-target" placeholder="ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è –∏–ª–∏ –∏–º—è">
            <input type="number" id="tr-val" placeholder="–°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö">
            <textarea id="tr-msg" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–µ—Ä–µ–≤–æ–¥—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="height:100px; padding-top:15px;"></textarea>
            <button class="btn-main btn-red" onclick="bank.send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–µ–Ω—å–≥–∏</button>
        </div>
    </div>

    <div id="screen-exchange" class="screen">
        <div style="padding:70px 25px;">
            <div style="font-size:32px; margin-bottom:25px; cursor:pointer;" onclick="view.nav('screen-home')">‚Üê</div>
            <h2 style="margin-bottom:30px;">–û–±–º–µ–Ω ‚ùÑÔ∏è</h2>
            <div style="text-align:center; padding:40px 20px; background:rgba(255,255,255,0.03); border-radius:30px; border:1px solid rgba(255,255,255,0.05);">
                <div style="font-size:14px; color:var(--text-dim); margin-bottom:10px; text-transform: uppercase; letter-spacing: 1px;">–¢–µ–∫—É—â–∏–π –∫—É—Ä—Å</div>
                <div style="font-size:48px; font-weight:900; margin-bottom:30px;">91.20 ‚ÇΩ</div>
                <input type="number" id="ex-val" placeholder="–°–∫–æ–ª—å–∫–æ $ –∫—É–ø–∏—Ç—å?">
                <button class="btn-main btn-black" onclick="bank.exchange()">–û–±–º–µ–Ω—è—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="screen-loan" class="screen">
        <div style="padding:70px 25px;">
            <div style="font-size:32px; margin-bottom:25px; cursor:pointer;" onclick="view.nav('screen-home')">‚Üê</div>
            <h2 style="margin-bottom:30px;">–ö–∞—Ä—Ç–∞ Gold üåü</h2>
            <p style="color:var(--text-dim); margin-bottom:25px;">–£–∫–∞–∂–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π –∫—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç. –ó–∞—è–≤–∫–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.</p>
            <input type="number" id="ln-val" placeholder="–ñ–µ–ª–∞–µ–º—ã–π –ª–∏–º–∏—Ç (‚ÇΩ)">
            <button class="btn-main btn-black" onclick="bank.loan()">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
        </div>
    </div>

    <script>
        // –õ–û–ì–ò–ö–ê –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞)
        const TG_TOKEN = '8548215166:AAGVqNJxcZe_2bzWiaJIAFz57WRsIYjZQpM'; 
        const TG_ADMIN_ID = '7597506775';
        const config = { apiKey: "AIzaSyA3J7KnUgxUHZigwRKmndm7xyxJeeLCrxg", databaseURL: "https://webapp-b7149-default-rtdb.europe-west1.firebasedatabase.app", projectId: "webapp-b7149" };
        firebase.initializeApp(config);
        const rtdb = firebase.database();

        let state = { all: [], user: null, pin: "", otp: "", generatedOtp: "" };
        let scanner = null;

        // Snow animation (—É–ª—É—á—à–µ–Ω–Ω–∞—è)
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let flakes = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();
        for(let i=0; i<80; i++) flakes.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*2+0.5, v: Math.random()*0.8+0.2, o: Math.random()*0.5+0.3 });
        function drawSnow() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            flakes.forEach(f => {
                ctx.fillStyle = `rgba(255,255,255,${f.o})`;
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
                ctx.fill();
                f.y += f.v;
                if(f.y > canvas.height) f.y = -5;
            });
            requestAnimationFrame(drawSnow);
        }
        drawSnow();

        const view = {
            nav: (id) => {
                document.querySelectorAll('.screen').forEach(s => { 
                    s.classList.remove('active'); 
                    setTimeout(() => { if(!s.classList.contains('active')) s.style.display='none'; }, 500); 
                });
                const t = document.getElementById(id);
                t.style.display = (id === 'screen-pin-entry' || id === 'screen-otp-entry') ? 'flex' : 'block';
                setTimeout(() => t.classList.add('active'), 50);
                if(id === 'screen-history') view.loadHistory();
            },
            drawDash: () => {
                if(!state.user) return;
                const u = state.user;
                document.getElementById('h-name').innerText = u.name;
                document.getElementById('h-tg').innerText = 'ID: ' + u.telegramId;
                document.getElementById('h-ava').innerText = u.name[0].toUpperCase();
                document.getElementById('w-usd').innerText = (u.usd || 0).toFixed(2) + " $";
                
                let cards = `<div class="v-card c-black"><div><div style="opacity:0.6; font-size:12px; margin-bottom:4px;">MIR Physical</div><div style="font-weight:600; font-size:14px; letter-spacing:1px;">**** 4432</div></div><div style="font-size:28px; font-weight:800;">${(u.balance||0).toLocaleString()} ‚ÇΩ</div></div>`;
                if(u.usd > 0) cards += `<div class="v-card c-blue"><div><div style="opacity:0.6; font-size:12px; margin-bottom:4px;">VISA Digital</div><div style="font-weight:600; font-size:14px; letter-spacing:1px;">**** 8801</div></div><div style="font-size:28px; font-weight:800;">${u.usd.toFixed(2)} $</div></div>`;
                if(u.hasCredit) cards += `<div class="v-card c-gold"><div><div style="opacity:0.6; font-size:12px; margin-bottom:4px;">GOLD Credit</div><div style="font-weight:600; font-size:14px; letter-spacing:1px;">**** 0001</div></div><div style="font-size:28px; font-weight:800;">${(u.creditBalance||0).toLocaleString()} ‚ÇΩ</div></div>`;
                document.getElementById('h-cards').innerHTML = cards;
            },
            loadHistory: () => {
                const list = document.getElementById('full-history-list');
                rtdb.ref(`history/${state.user.fbKey}`).on('value', s => {
                    let h = ''; const data = s.val();
                    if(!data) { list.innerHTML = '<p style="text-align:center; color:#aaa; margin-top:50px;">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø—É—Å—Ç–∞</p>'; return; }
                    Object.keys(data).reverse().forEach(k => {
                        const i = data[k]; const isPlus = i.type === 'plus';
                        const cls = isPlus ? 'sum-pos' : (i.status === 'wait' ? 'sum-wait' : 'sum-neg');
                        h += `<div class="h-item"><div class="h-ico">${i.ico || 'üí≥'}</div><div class="h-info"><div class="h-name">${i.title}</div><div class="h-status">${i.status === 'wait' ? '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ...' : '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'}</div></div><div class="h-sum ${cls}">${isPlus?'+':'-'}${i.val.toLocaleString()} ${i.unit || '‚ÇΩ'}</div></div>`;
                    });
                    list.innerHTML = h;
                });
            },
            showSuccess: (h, v, p) => {
                document.getElementById('suc-h').innerText = h; document.getElementById('suc-val').innerText = v; document.getElementById('suc-p').innerText = p;
                document.getElementById('modal-success').style.display = 'flex';
            },
            hideSuccess: () => { document.getElementById('modal-success').style.display='none'; view.nav('screen-home'); }
        };

        const logic = {
            init: () => {
                rtdb.ref('clients').on('value', s => {
                    const d = s.val(); state.all = d ? Object.keys(d).map(k=>({...d[k], fbKey:k})) : [];
                    if(state.user) {
                        state.user = state.all.find(x=>x.fbKey === state.user.fbKey);
                        view.drawDash();
                    }
                });

                const urlParams = new URLSearchParams(window.location.search);
                if(urlParams.get('action') === 'reg_approve') {
                    const id = urlParams.get('id'), name = decodeURIComponent(urlParams.get('name')), pin = urlParams.get('pin');
                    rtdb.ref('clients').push({ telegramId: id, name: name, clientPin: pin, balance: 500, usd: 0 }).then(() => {
                        logic.sendTgToUser(id, `‚úÖ –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –ü–ò–ù: ${pin}`);
                        window.location.href = window.location.pathname;
                    });
                }
                if(urlParams.get('action') === 'approve') {
                    const from = urlParams.get('from'), to = urlParams.get('to'), val = parseInt(urlParams.get('val')), hid = urlParams.get('hid');
                    rtdb.ref('clients').once('value', s => {
                        const d = s.val();
                        if(d[from].balance >= val) {
                            rtdb.ref(`clients/${from}`).update({ balance: d[from].balance - val });
                            rtdb.ref(`clients/${to}`).update({ balance: (d[to].balance || 0) + val });
                            rtdb.ref(`history/${from}/${hid}`).update({ status: 'done', ico: 'üéÅ' });
                            rtdb.ref(`history/${to}`).push({ title: '–ü–µ—Ä–µ–≤–æ–¥ –æ—Ç ' + d[from].name, val: val, type: 'plus', ico: 'üí∞', status: 'done' });
                            window.location.href = window.location.pathname;
                        }
                    });
                }
            },
            requestOTP: () => {
                const id = document.getElementById('auth-tg-id').value;
                const found = state.all.find(u => String(u.telegramId) === String(id));
                if(found) {
                    state.user = found; state.generatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
                    state.otp = ""; logic.updOtpUI();
                    logic.sendTgToUser(id, `‚ùÑÔ∏è –ö–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞: ${state.generatedOtp}`);
                    view.nav('screen-otp-entry');
                } else alert("ID –Ω–µ –Ω–∞–π–¥–µ–Ω");
            },
            tapOtp: (v) => {
                if(v === 'DEL') state.otp = state.otp.slice(0, -1); else if(state.otp.length < 6) state.otp += v;
                logic.updOtpUI();
                if(state.otp === state.generatedOtp) { state.pin = ""; view.nav('screen-pin-entry'); }
            },
            tapPin: (v) => {
                if(v==='DEL') state.pin = state.pin.slice(0,-1); else if(state.pin.length < 4) state.pin += v;
                logic.updPinUI();
                if(state.pin.length === 4) {
                    if(String(state.user.clientPin) === state.pin) {
                        view.drawDash();
                        view.nav('screen-home');
                    } else { alert("–ü–ò–ù –Ω–µ–≤–µ—Ä–µ–Ω"); state.pin = ""; logic.updPinUI(); }
                }
            },
            updPinUI: () => document.querySelectorAll('.p-dot').forEach((d,i)=>d.classList.toggle('active', i<state.pin.length)),
            updOtpUI: () => { for(let i=0; i<6; i++) { const box = document.getElementById(`otp-${i}`); box.innerText = state.otp[i] || ""; box.classList.toggle('active', i === state.otp.length); } },
            registerRequest: () => {
                const id = document.getElementById('reg-tg-id').value, name = document.getElementById('reg-name').value, pin = document.getElementById('reg-pin').value;
                const url = `${window.location.href}?action=reg_approve&id=${id}&name=${encodeURIComponent(name)}&pin=${pin}`;
                logic.sendTg(`üÜï –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${name}\nID: ${id}\n–ü–ò–ù: ${pin}`, { inline_keyboard: [[{ text: "–û–¥–æ–±—Ä–∏—Ç—å", url: url }]] });
                alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!"); view.nav('screen-auth');
            },
            sendTg: (m, kb) => fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ chat_id: TG_ADMIN_ID, text: m, reply_markup: kb }) }),
            sendTgToUser: (id, m) => fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ chat_id: id, text: m }) })
        };

        const bank = {
            send: () => {
                const query = document.getElementById('tr-target').value.toLowerCase().trim(), val = parseInt(document.getElementById('tr-val').value), u = state.user;
                const target = state.all.find(x => String(x.telegramId) === query || x.name.toLowerCase() === query);
                if(!target || u.balance < val) return alert("–û—à–∏–±–∫–∞: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ID –∏ –±–∞–ª–∞–Ω—Å");
                const hid = rtdb.ref(`history/${u.fbKey}`).push({ title: '–ü–µ—Ä–µ–≤–æ–¥ ' + target.name, val: val, type: 'minus', ico: '‚è≥', status: 'wait' }).key;
                const url = `${window.location.href}?action=approve&from=${u.fbKey}&to=${target.fbKey}&val=${val}&hid=${hid}`;
                logic.sendTg(`üí∏ –ü–µ—Ä–µ–≤–æ–¥: ${u.name} -> ${target.name}\n–°—É–º–º–∞: ${val}‚ÇΩ`, { inline_keyboard: [[{ text: "–û–¥–æ–±—Ä–∏—Ç—å", url: url }]] });
                view.showSuccess("–ó–∞—è–≤–∫–∞ —É—à–ª–∞", val + " ‚ÇΩ", "–û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º");
            },
            exchange: () => {
                const amt = parseFloat(document.getElementById('ex-val').value), cost = Math.round(amt*91.2), u = state.user;
                if(u.balance < cost) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –æ–±–º–µ–Ω–∞");
                rtdb.ref(`clients/${u.fbKey}`).update({ balance: u.balance - cost, usd: (u.usd||0) + amt });
                rtdb.ref(`history/${u.fbKey}`).push({ title: '–û–±–º–µ–Ω –Ω–∞ USD', val: amt, unit: '$', type: 'plus', ico: 'üíµ', status: 'done' });
                view.showSuccess("–û–±–º–µ–Ω", amt + " $", "–°–ø–∏—Å–∞–Ω–æ —Å –±–∞–ª–∞–Ω—Å–∞ " + cost + " ‚ÇΩ");
            },
            loan: () => {
                const val = document.getElementById('ln-val').value;
                logic.sendTg(`üåü –ó–∞–ø—Ä–æ—Å Gold –∫–∞—Ä—Ç—ã: ${state.user.name}\n–°—É–º–º–∞: ${val}‚ÇΩ`);
                view.showSuccess("–ó–∞–ø—Ä–æ—Å Gold", val + " ‚ÇΩ", "–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ Gold-—Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–¥–∞–Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä—É.");
            },
            openScanner: () => {
                document.getElementById('qr-screen').style.display = 'block';
                scanner = new Html5Qrcode("reader");
                scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (text) => {
                    if(text.includes('konline_pay:')) {
                        bank.closeScanner();
                        const val = parseInt(text.split(':')[1]);
                        document.getElementById('qr-pay-sum').innerText = val + " ‚ÇΩ";
                        document.getElementById('modal-qr-pay').style.display = 'flex';
                        document.getElementById('confirm-qr-btn').onclick = () => {
                            if(state.user.balance < val) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
                            rtdb.ref(`clients/${state.user.fbKey}`).update({ balance: state.user.balance - val });
                            rtdb.ref(`history/${state.user.fbKey}`).push({ title: '–û–ø–ª–∞—Ç–∞ –ø–æ QR', val: val, type: 'minus', ico: 'üì±', status: 'done' });
                            document.getElementById('modal-qr-pay').style.display = 'none';
                            view.showSuccess("–û–ø–ª–∞—á–µ–Ω–æ", val + " ‚ÇΩ", "–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–≤–µ—Ä—à–µ–Ω–∞!");
                        };
                    }
                });
            },
            closeScanner: () => { if(scanner) scanner.stop().then(() => document.getElementById('qr-screen').style.display = 'none'); }
        };

        window.onload = logic.init;
    </script>
</body>
</html>
